trigger:
- None

name: '1.0.$(Build.BuildId)'

variables:
- name: androidKeystoreKeyAlias
  value: key

jobs:
- job: BuildAndroid
  displayName: Build for Android
  pool:
    vmImage: 'ubuntu-latest'

  steps:
  - task: FlutterInstall@0
    inputs:
     mode: 'auto'
     channel: 'stable'
     version: 'latest'
  - task: CmdLine@2
    inputs:
      script: |
        ls
        chmod +x '/opt/hostedtoolcache/Flutter/3.7.12/linux/flutter/*'
        /opt/hostedtoolcache/Flutter/3.7.12/linux/flutter build apk --profile --dart-define=RELEASE_MODE=true

  - task: FlutterBuild@0
    inputs:
      target: 'apk'
      projectDirectory: '$(Build.SourcesDirectory)'
      debugMode: true
      buildFlavour: 'dev'
      buildName: '$(Build.BuildNumber)'
  - task: PublishBuildArtifacts@1
    displayName: Publish artifact
    inputs:
      PathtoPublish: '$(Build.Repository.LocalPath)/build/app/outputs/apk/release'
      ArtifactName: 'apk'
      publishLocation: 'Container'
